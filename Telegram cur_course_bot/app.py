""" Telegram-–±–æ—Ç cur_course_bot
–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç: t.me/cur_course_bot
–ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—É –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–ª—é—Ç—ã (–µ–≤—Ä–æ, –¥–æ–ª–ª–∞—Ä –∏–ª–∏ —Ä—É–±–ª—å).

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ pytelegrambotapi.
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ –≤–∏–¥–µ:
    <–∏–º—è –≤–∞–ª—é—Ç—ã, —Ü–µ–Ω—É –∫–æ—Ç–æ—Ä–æ–π –æ–Ω —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å> <–∏–º—è –≤–∞–ª—é—Ç—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–¥–æ —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—É –ø–µ—Ä–≤–æ–π –≤–∞–ª—é—Ç—ã>
    <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–≤–æ–π –≤–∞–ª—é—Ç—ã>.
–ü—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã /start –∏–ª–∏ /help –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –±–æ—Ç–∞.
–ü—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã /values –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö –≤ —á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API https://min-api.cryptocompare.com/documentation
–∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Requests.
–î–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ JSON.

–ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–≤–µ–¥–µ–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–ª–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –≤–∞–ª—é—Ç–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–µ–¥–µ–Ω–æ —á–∏—Å–ª–æ)
–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ APIExceptionError —Å —Ç–µ–∫—Å—Ç–æ–º –ø–æ—è—Å–Ω–µ–Ω–∏—è –æ—à–∏–±–∫–∏.
–¢–µ–∫—Å—Ç –ª—é–±–æ–π –æ—à–∏–±–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Å–æ–æ–±—â–µ–Ω–∏—è.
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –æ–ø–∏—Å–∞–Ω –∫–ª–∞—Å—Å  CryptoConverter —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –º–µ—Ç–æ–¥–æ–º get_price(),
–∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–∂–Ω—É—é —Å—É–º–º—É –≤ –≤–∞–ª—é—Ç–µ:
    –∏–º—è –≤–∞–ª—é—Ç—ã, —Ü–µ–Ω—É –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω–∞–¥–æ —É–∑–Ω–∞—Ç—å, ‚Äî base;
    –∏–º—è –≤–∞–ª—é—Ç—ã, —Ü–µ–Ω—É –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–¥–æ —É–∑–Ω–∞—Ç—å, ‚Äî quote;
    –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∏–º–æ–π –≤–∞–ª—é—Ç—ã ‚Äî amount.

–¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ config.py.
–ö–ª–∞—Å—Å—ã –≤ —Ñ–∞–π–ª–µ extensions.py.

"""

import telebot
import emoji
from config import TOKEN, keys, text_for_user, excess_parameters, not_enough_parameters
from extensions import APIExceptionError, CryptoConverter

bot = telebot.TeleBot(TOKEN)
emo = emoji.emojize


@bot.message_handler(commands=['help', 'start'])
def command_help(message: telebot.types.Message):
    bot.reply_to(message, text_for_user)


@bot.message_handler(commands=['values'])
def command_values(message: telebot.types.Message):
    text = '–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–ª—é—Ç—ã:\n'
    for key in keys.keys():
        text = '\n'.join((text, key,))
    bot.reply_to(message, text)


@bot.message_handler(content_types=['text', ])
def convert(message: telebot.types.Message):
    try:
        values = message.text.lower().replace(',', '.').split(' ')

        if len(values) > 3:
            raise APIExceptionError(excess_parameters)
        elif len(values) < 2:
            raise APIExceptionError(not_enough_parameters)
        elif len(values) == 2:
            values.append('1')

        quote, base, amount = values
        total_base = CryptoConverter.get_price(quote, base, amount)
    except APIExceptionError as e:
        bot.reply_to(message, emo(f'–ß—Ç–æ —Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ ü§∑üèª‚Äç‚ôÇÔ∏è\n{e}'))
    except Exception as e:
        bot.reply_to(message, f'–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É\n{e}')
    else:
        text = f'–¶–µ–Ω–∞ {amount} {quote} –≤ {base} - {total_base}'
        bot.send_message(message.chat.id, text)


bot.polling()
